#!/bin/bash

OWN_DIR='/groups/scicompsoft/home/ackermand/Programming/cosem-segmentation-analysis'
JAR=$OWN_DIR/target/cosem-segmentation-analysis-0.0.1-SNAPSHOT.jar

FLINTSTONE=/groups/flyTEM/flyTEM/render/spark/spark-janelia/flintstone.sh
CLASS=org.janelia.cosem.analysis.SparkIDFilter
N_NODES=150
# cluster currently full so decreasing the amount
#export N_CORES_DRIVER=30
#export N_EXECUTORS_PER_NODE=15
export N_CORES_DRIVER=4
export N_EXECUTORS_PER_NODE=1
export N_CORES_PER_EXECUTOR=10
# export N_OVERHEAD_CORES_PER_WORKER=8
export N_OVERHEAD_CORES_PER_WORKER=1

export LSF_PROJECT=cellmap
export RUNTIME="48:00"
export JAVA_HOME="/usr/lib/jvm/java-1.8.0"

cell=${PWD##*/}


ARGV="\
--inputN5Path '/nrs/cellmap/ackermand/cellmap/${cell}.n5'  \
--inputN5DatasetName 'nucleus' \
--idsToKeep '5,7,9,12,13,16,18,19,20,25,27,28,32,37,41,43,46,47,50,51,52,54,57,61,64,70,72,73,75,76,78,81,82,84,85,87,91,92,93,95,96,100,102,107,108,109,110,111,112,114,117,118,119,120,131,133,134,137,138,139,141,142,150,151,156,157,158,159,160,162,163,169,171,172,173,174,175,176,177,179,183,184,185,186,187,188,192,193,194,195,196,197,198,200,202,203,207,208,209,210,211,212,213,214,215,216,219,220,226,238,242,244,252,253,254,255,258,264,266,267,271,276,277,279,281,282,284,285,287,289,290,291,295,296,302,304,305,306,307,308,310,311,312,313,315,317,318,320,321,322,323,324,325,329,331,332,333,335,342,347,349,350,351,354,355,356,357,358,359,360,361,362,366,367,368,369,371,372,375,377,378,381,383,384,385,391,392,396,398,399,407,408,410,412,413,419,421,422,424,425,428,433,434,439,440,441,442,443,452,453,455,460,466,467,468,469,470,472,473,475,476,478,482,486,487,488,490,491,493,495,507,508,509,511,512,513,517,521,528,534,535,536,537,538,539,541,542,543,550,552,553,557,564,565,566,567,568,571,572,576,579,581,582,590,591,594,596,599,600,604,607,608,617,618,626,627,631,632,635,649,650,651,654,655,657,659,660,664,665,666,674,675,676,677,685,687,688,689,690,692,693,697,699,710,711,712,714,715,716,722,724,725,727,731,734,739,741,746,747,754,755,756,759,764,765,766,775,776,778,779,780,781,782,783,784,785,792,794,795,796,797,805,806,811,823,824,826,827,828,830,841,842,844,847,848,849,857,859,865,875,876,879,882,883,888,889,890,893,898,900,903,906,915,920,922,924,925,933,934,935,936,937,938,946,947,948,950,951,952,954,955,958,967,968,977,978,979,980,981,982,983,985,986,994,995,1000,1012,1013,1015,1016,1017,1021,1022,1023,1024,1026,1040,1042,1043,1044,1054,1057,1062,1063,1064,1065,1066,1067,1068,1075,1077,1079,1081,1083,1084,1085,1088,1095,1096,1097,1100,1102,1103,1104,1107,1108,1109,1110,1116,1119,1120,1121,1122,1123,1128,1132,1143,1144,1148,1149,1158,1160,1162,1164,1165,1167,1168,1174,1178,1181,1185,1186,1187,1190,1200,1203,1204,1205,1208,1209,1212,1213,1214,1220,1222,1225,1226,1230,1231,1232,1242,1243,1245,1246,1247,1250,1251,1262,1264,1265,1267,1269,1270,1271,1272,1274,1276,1279,1287,1288,1289,1291,1293,1295,1296,1298,1303,1305,1308,1309,1310,1311,1313,1316,1320,1322,1329,1330,1332,1334,1337,1338,1339,1340,1341,1343,1344,1345,1358,1359,1360,1363,1364,1365,1366,1367,1371,1372,1373,1376,1384,1385,1386,1387,1390,1399,1402,1403,1404,1405,1407,1408,1411,1412,1414,1417,1418,1423,1425,1426,1428,1435,1437,1438,1441,1443,1445,1447,1448,1452,1455,1456,1457,1459,1461,1463,1465,1466,1467,1468,1469,1474,1476,1478,1481,1482,1483,1485,1488,1489,1491,1492,1493,1495,1496,1500,1503,1505,1506,1509,1510,1518,1519,1521,1522,1523,1524,1530,1532,1534,1535,1536,1537,1538,1539,1548,1549,1550,1551,1552,1553,1554,1559,1561,1569,1571,1574,1576,1577,1579,1580,1582,1583,1584,1585,1586,1588,1590,1591,1592,1593,1603,1605,1607,1609,1610,1612,1613,1615,1616,1617,1620,1622,1623,1624,1636,1637,1638,1640,1641,1642,1644,1645,1646,1647,1648,1652,1655,1656,1664,1666,1670,1671,1676,1677,1678,1681,1682,1683,1685,1689,1704,1706,1711,1712,1715,1717,1719,1720,1724,1731,1742,1745,1747,1748,1752,1753,1756,1757,1762,1764,1771,1775,1785,1786,1799,1802,1809,1827,1831,1833,1835,1836,1845,1847,1851,1856,1862,1869,1881,1885,1890,1894,1896,1900,1903,1904,1908,1913,1915,1918,1921,1927,1928,1929,1930,1932,1940,1951,1954,1955,1957,1958,1961,1972,1977,1981,1983,1985,1988,1995,1999,2002,2004,2005,2006,2009,2011,2019,2021,2023,2029,2030,2041,2053,2057,2067,2068,2070,2072,2073,2079,2080,2081,2082,2083,2088,2089,2091,2095,2099,2112,2115,2116,2117,2119,2124,2126,2129,2135,2136,2140,2141,2143,2152,2156,2157,2158,2160,2166,2168,2171,2176,2179,2189,2191,2193,2200,2201' \
"

TERMINATE=1 $FLINTSTONE $N_NODES $JAR $CLASS $ARGV
sleep 1

